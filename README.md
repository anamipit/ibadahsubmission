# Ibadah Submission Web App

Simple web application untuk menampilkan data submissions dari Supabase dengan Express.js.

## Fitur

- âœ… Fetch data dari Supabase
- âœ… Menampilkan data dalam tabel
- âœ… Melihat detail 1 record submission
- âœ… Parsing JSON fields (jawaban_refleksi & jawaban_kuis) ke dalam tabel terpisah
- âœ… Tanpa autentikasi/login
- âœ… Tanpa fitur edit/delete
- âœ… Responsif untuk mobile dan desktop

## Quick Start

### **Local Development:**

1. **Clone repository dan install dependencies:**
   ```bash
   git clone https://github.com/yourusername/ibadahsubmission.git
   cd ibadahsubmission
   npm install
   ```

2. **Setup environment variables:**
   - Copy file `env-template.txt` menjadi `.env`
   - Isi dengan kredential Supabase Anda:
   ```
   SUPABASE_URL=your_supabase_project_url_here
   SUPABASE_ANON_KEY=your_supabase_anon_key_here
   PORT=3000
   ```

3. **Jalankan aplikasi:**
   ```bash
   # Development mode
   npm run dev

   # Production mode
   npm start
   ```

4. **Buka browser:**
   Akses `http://localhost:3000`

### **Vercel Deployment (One-Click):**

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/yourusername/ibadahsubmission)

1. **Klik tombol "Deploy with Vercel" di atas**
2. **Import repository dari GitHub**
3. **Set environment variables di Vercel dashboard:**
   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
4. **Deploy!** ðŸš€

Aplikasi akan otomatis deploy dan tersedia di URL Vercel.

## Struktur Database

Aplikasi ini menggunakan tabel `submissions` dengan struktur:

```sql
CREATE TABLE public.submissions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
    nama TEXT NOT NULL,
    kelas TEXT NOT NULL,
    jawaban_refleksi JSONB,
    jawaban_kuis JSONB,
    skor INTEGER
);
```

## Deployment ke Vercel

Vercel adalah platform yang sempurna untuk aplikasi Express.js ini. Berikut langkah-langkah deployment:

### 1. **Persiapan Repository**
Pastikan repository sudah di-push ke GitHub dengan struktur file yang benar:
```
ibadahsubmission/
â”œâ”€â”€ server.js               # Main Express server
â”œâ”€â”€ package.json            # Dependencies
â”œâ”€â”€ vercel.json            # Vercel configuration
â”œâ”€â”€ .env                   # Environment variables (tidak di-commit)
â””â”€â”€ ... (file lainnya)
```

### 2. **Setup Environment Variables di Vercel**
1. Buka [Vercel Dashboard](https://vercel.com/dashboard)
2. Import project dari GitHub
3. Di project settings â†’ Environment Variables, tambahkan:
   ```
   SUPABASE_URL=your_supabase_project_url_here
   SUPABASE_ANON_KEY=your_supabase_anon_key_here
   ```

### 3. **Deploy via Vercel CLI (Optional)**
```bash
# Install Vercel CLI
npm i -g vercel

# Login ke Vercel
vercel login

# Deploy
vercel

# Untuk production
vercel --prod
```

### 4. **Deploy via GitHub Integration (Recommended)**
1. Connect GitHub repository ke Vercel
2. Vercel akan auto-deploy setiap kali ada push ke main branch
3. Set environment variables di Vercel dashboard
4. Deploy otomatis!

### 5. **Custom Domain (Optional)**
- Di Vercel dashboard â†’ Domains
- Tambahkan custom domain Anda
- Update DNS records sesuai instruksi Vercel

## Alternative Deployment Options

Jika tidak menggunakan Vercel, Anda bisa deploy ke:
- **Railway**: `railway up`
- **Heroku**: `git push heroku main`
- **DigitalOcean App Platform**: Via dashboard
- **Render**: Connect GitHub repository

## API Endpoints

- `GET /api/submissions` - Mendapatkan semua submissions
- `GET /api/submissions/:id` - Mendapatkan submission berdasarkan ID
- `GET /api/submissions/:id/parsed` - Mendapatkan submission dengan JSON fields yang sudah diparsing

## Struktur File

```
ibadahsubmission/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ supabase.js          # Konfigurasi Supabase client
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ submissions.js       # API routes untuk submissions
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html          # Halaman utama (tabel submissions)
â”‚   â”œâ”€â”€ detail.html         # Halaman detail submission
â”‚   â””â”€â”€ styles.css          # CSS styling
â”œâ”€â”€ server.js               # Main Express server
â”œâ”€â”€ package.json            # Dependencies
â”œâ”€â”€ env-template.txt        # Template environment variables
â””â”€â”€ README.md              # Dokumentasi
```

## Troubleshooting

### **Local Development Issues:**

1. **Error koneksi Supabase:**
   - Pastikan `SUPABASE_URL` dan `SUPABASE_ANON_KEY` sudah benar
   - Pastikan tabel `submissions` sudah dibuat di Supabase
   - Pastikan RLS policy sudah dikonfigurasi untuk anonymous access

2. **Data tidak muncul:**
   - Cek console browser untuk error
   - Pastikan ada data di tabel `submissions`
   - Cek network tab untuk melihat response API

3. **Port sudah digunakan:**
   - Ubah PORT di file `.env`
   - Atau kill process yang menggunakan port 3000

### **Vercel Deployment Issues:**

1. **Environment Variables Error:**
   - Pastikan environment variables sudah diset di Vercel dashboard
   - Redeploy setelah mengubah environment variables
   - Cek Vercel function logs untuk error details

2. **Build Error:**
   - Pastikan `vercel.json` sudah benar
   - Cek bahwa `server.js` adalah entry point yang benar
   - Pastikan semua dependencies ada di `package.json`

3. **Runtime Error:**
   - Cek Vercel function logs
   - Pastikan Supabase connection string valid
   - Test API endpoints di Vercel deployment URL

4. **CORS Issues:**
   - Pastikan CORS sudah dikonfigurasi dengan benar
   - Tambahkan domain Vercel ke Supabase CORS settings jika perlu

### **Debugging Commands:**
```bash
# Test local environment
node -e "require('dotenv').config(); console.log(process.env.SUPABASE_URL);"

# Test Vercel deployment
curl https://your-app.vercel.app/api/submissions

# Check Vercel logs
vercel logs your-app-name
```