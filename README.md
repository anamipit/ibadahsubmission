# Ibadah Submission Web App

Simple web application untuk menampilkan data submissions dari Supabase dengan Express.js.

## Fitur

- ✅ Fetch data dari Supabase
- ✅ Menampilkan data dalam tabel
- ✅ Melihat detail 1 record submission
- ✅ Parsing JSON fields (jawaban_refleksi & jawaban_kuis) ke dalam tabel terpisah
- ✅ Tanpa autentikasi/login
- ✅ Tanpa fitur edit/delete
- ✅ Responsif untuk mobile dan desktop

## Setup

1. **Clone repository dan install dependencies:**
   ```bash
   npm install
   ```

2. **Setup environment variables:**
   - Copy file `env-template.txt` menjadi `.env`
   - Isi dengan kredential Supabase Anda:
   ```
   SUPABASE_URL=your_supabase_project_url_here
   SUPABASE_ANON_KEY=your_supabase_anon_key_here
   PORT=3000
   ```

3. **Jalankan aplikasi:**
   ```bash
   # Development mode
   npm run dev

   # Production mode
   npm start
   ```

4. **Buka browser:**
   Akses `http://localhost:3000`

## Struktur Database

Aplikasi ini menggunakan tabel `submissions` dengan struktur:

```sql
CREATE TABLE public.submissions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
    nama TEXT NOT NULL,
    kelas TEXT NOT NULL,
    jawaban_refleksi JSONB,
    jawaban_kuis JSONB,
    skor INTEGER
);
```

## Deployment ke Cloudflare Pages

1. **Build aplikasi untuk static hosting:**
   Karena Cloudflare Pages adalah static hosting, Anda perlu menggunakan serverless functions atau mengonversi ke static site.

2. **Alternative deployment options:**
   - Vercel (mendukung Node.js/Express)
   - Heroku
   - Railway
   - DigitalOcean App Platform

## API Endpoints

- `GET /api/submissions` - Mendapatkan semua submissions
- `GET /api/submissions/:id` - Mendapatkan submission berdasarkan ID
- `GET /api/submissions/:id/parsed` - Mendapatkan submission dengan JSON fields yang sudah diparsing

## Struktur File

```
ibadahsubmission/
├── config/
│   └── supabase.js          # Konfigurasi Supabase client
├── routes/
│   └── submissions.js       # API routes untuk submissions
├── public/
│   ├── index.html          # Halaman utama (tabel submissions)
│   ├── detail.html         # Halaman detail submission
│   └── styles.css          # CSS styling
├── server.js               # Main Express server
├── package.json            # Dependencies
├── env-template.txt        # Template environment variables
└── README.md              # Dokumentasi
```

## Troubleshooting

1. **Error koneksi Supabase:**
   - Pastikan `SUPABASE_URL` dan `SUPABASE_ANON_KEY` sudah benar
   - Pastikan tabel `submissions` sudah dibuat di Supabase
   - Pastikan RLS policy sudah dikonfigurasi untuk anonymous access

2. **Data tidak muncul:**
   - Cek console browser untuk error
   - Pastikan ada data di tabel `submissions`
   - Cek network tab untuk melihat response API

3. **Port sudah digunakan:**
   - Ubah PORT di file `.env`
   - Atau kill process yang menggunakan port 3000